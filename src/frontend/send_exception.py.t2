;;; ../ntpy-server
;; define functions
def msg_exception(txt, lines):
  ; get task id
  msg = {}
  msg["cmd"] = "exception"
  msg["data"] = { "task_id": task_id, "text": txt, "lines": lines }
  return json.dumps(msg)

;; send exception to frontend
for frontend_writer in frontend_writers:
  frontend_writer.send(msg_exception(str(e), tangled[name]))
  await frontend_writer.drain()
